import 'package:shared_preferences/shared_preferences.dart';

class UserData {
  static final UserData _instance = UserData._internal();
  
  factory UserData() {
    return _instance;
  }
  
  UserData._internal();

  String namaLengkap = '';
  String namaPengguna = '';
  String email = '';
  String nomorTelepon = '';
  String tanggalLahir = '';
  String kategori = '';
  String password = '';
  
  // Membership fields
  bool isMember = false;
  String ktaStatus = 'none'; // none, pending, approved, rejected
  String membershipNumber = '';
  String membershipValidFrom = '';
  String membershipValidUntil = '';
  String ktaImagePath = ''; // Path to uploaded KTA image

  // Load data from SharedPreferences
  Future<void> loadData() async {
    final prefs = await SharedPreferences.getInstance();
    namaLengkap = prefs.getString('namaLengkap') ?? '';
    namaPengguna = prefs.getString('namaPengguna') ?? '';
    email = prefs.getString('email') ?? '';
    nomorTelepon = prefs.getString('nomorTelepon') ?? '';
    tanggalLahir = prefs.getString('tanggalLahir') ?? '';
    kategori = prefs.getString('kategori') ?? '';
    password = prefs.getString('password') ?? '';
    isMember = prefs.getBool('isMember') ?? false;
    ktaStatus = prefs.getString('ktaStatus') ?? 'none';
    membershipNumber = prefs.getString('membershipNumber') ?? '';
    membershipValidFrom = prefs.getString('membershipValidFrom') ?? '';
    membershipValidUntil = prefs.getString('membershipValidUntil') ?? '';
    ktaImagePath = prefs.getString('ktaImagePath') ?? '';
  }

  // Save data to SharedPreferences
  Future<void> saveData() async {
    final prefs = await SharedPreferences.getInstance();
    await prefs.setString('namaLengkap', namaLengkap);
    await prefs.setString('namaPengguna', namaPengguna);
    await prefs.setString('email', email);
    await prefs.setString('nomorTelepon', nomorTelepon);
    await prefs.setString('tanggalLahir', tanggalLahir);
    await prefs.setString('kategori', kategori);
    await prefs.setString('password', password);
    await prefs.setBool('isMember', isMember);
    await prefs.setString('ktaStatus', ktaStatus);
    await prefs.setString('membershipNumber', membershipNumber);
    await prefs.setString('membershipValidFrom', membershipValidFrom);
    await prefs.setString('membershipValidUntil', membershipValidUntil);
    await prefs.setString('ktaImagePath', ktaImagePath);
  }

  // Calculate kategori based on tanggal lahir
  String calculateKategori(DateTime birthDate) {
    final now = DateTime.now();
    final age = now.year - birthDate.year - 
                ((now.month > birthDate.month || 
                  (now.month == birthDate.month && now.day >= birthDate.day)) 
                  ? 0 : 1);

    if (age < 9) {
      return 'U9';
    } else if (age < 12) {
      return 'U12';
    } else if (age < 15) {
      return 'U15';
    } else {
      return 'Dewasa';
    }
  }

  Future<void> clearData() async {
    namaLengkap = '';
    namaPengguna = '';
    email = '';
    nomorTelepon = '';
    tanggalLahir = '';
    kategori = '';
    password = '';
    
    // Clear from SharedPreferences
    final prefs = await SharedPreferences.getInstance();
    await prefs.clear();
  }
}
